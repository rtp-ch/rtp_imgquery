<!DOCTYPE html>
<html>
  <head>
    <title>rtp_imgQuery Tests</title>
    <link rel="stylesheet" href="qunit/qunit.css">
    <script type="text/javascript">
      var imgQry = {};
      imgQry.images = {};
      imgQry.ratios = {};
      imgQry.breakpoints = {};
      
    </script>
  </head>
  <body>
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    <script src="qunit/qunit.js" type="text/javascript"></script>
    <script type="text/javascript">
      var imagesIn = {
              "1":    {
                  "500" : '<img src="Images/pixel_ratio_1/400.gif" width="400" height="400">',
                  "700" : '<img src="Images/pixel_ratio_1/300.gif" width="300" height="300">',
                  "800" : '<img src="Images/pixel_ratio_1/750.gif" width="750" height="750">',
                  "1000" : '<img src="Images/pixel_ratio_1/900.gif" width="900" height="900">'
              },
              "1.5":    {
                  "500" : '<img src="Images/pixel_ratio_1_5/400.gif" width="400" height="400">',
                  "700" : '<img src="Images/pixel_ratio_1_5/300.gif" width="300" height="300">',
                  "800" : '<img src="Images/pixel_ratio_1_5/750.gif" width="750" height="750">',
                  "1000" : '<img src="Images/pixel_ratio_1_5/900.gif" width="900" height="900">'
              },
              "2":    {
                  "500" : '<img src="Images/pixel_ratio_2/400.gif" width="400" height="400">',
                  "700" : '<img src="Images/pixel_ratio_2/300.gif" width="300" height="300">',
                  "800" : '<img src="Images/pixel_ratio_2/750.gif" width="750" height="750">',
                  "1000" : '<img src="Images/pixel_ratio_2/900.gif" width="900" height="900">'
              }
      },
          breakpointsIn = [500,700,800,1000],
          ratiosIn = [1,1.5,2],
          cacheKeyIn = JSON.stringify(imagesIn);
          
      // Device Pixel ratio
      imgQry.ratios = {};
      imgQry.ratio = 2.2;
      
      // Window width
      imgQry.width = 300;
      
    </script><script type="text/javascript">({write:function(i){"complete"!==document.readyState&&document.write(i)},closest:function(i,t){"use strict";for(var r=i.length,e=0;r>e&&!(i[e]>=t);)e+=1;return e=e===r?r-1:e},sort:function(i,t){"use strict";return t>i?-1:t>i?1:0},imgQry:function(i,t,r,e,o){"use strict";t=t.sort(this.sort),e=e.sort(this.sort),i.imgQry===void 0&&(i.imgQry={}),i.imgQry.images===void 0&&(i.imgQry.images={}),i.imgQry.ratios===void 0&&(i.imgQry.ratios={}),i.imgQry.breakpoints===void 0&&(i.imgQry.breakpoints={}),i.imgQry.width===void 0&&(i.imgQry.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0),i.imgQry.ratio===void 0&&(i.imgQry.ratio=i.devicePixelRatio!==void 0?i.devicePixelRatio:1),i.imgQry.ratios[e]===void 0&&(i.imgQry.ratios[e]=e[this.closest(e,i.imgQry.ratio)]),i.imgQry.breakpoints[t]===void 0&&(i.imgQry.breakpoints[t]=t[this.closest(t,i.imgQry.width)]),i.imgQry.images[o]===void 0&&(i.imgQry.images[o]=r[i.imgQry.ratios[e]][i.imgQry.breakpoints[t]]),this.write(i.imgQry.images[o])}}).imgQry(this,breakpointsIn,imagesIn,ratiosIn,cacheKeyIn);</script>
    <script type="text/javascript">
      test('Small image selection for window width 300', function() {
          var actualImage = imgQry.images[cacheKeyIn],
              expectedImage = imagesIn["2"]["500"];
          equal(actualImage, expectedImage, 'Expected smallest image for pixel ratio 2');
      });
    </script>
  </body>
</html>